<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Leave Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<div class="app">

  <aside class="sidebar">
    <h2>HR Admin</h2>
    <a href="dashboard.html">Dashboard</a>
    <a href="employees.html">Employees</a>
    <a href="attendance.html">Attendance</a>
    <a href="leave.html" class="active">Leave</a>
    <a href="hr.html">HR / Admin</a>
    <button id="logoutBtn" class="theme-toggle">Logout</button>
  </aside>

  <main class="main">

    <div class="topbar">
      <h1>Leave Management</h1>
      <button id="menuBtn" class="theme-toggle">☰ Menu</button>
      <button id="themeToggle" class="theme-toggle">Light / Dark</button>
    </div>

    <section class="kpi-grid">
      <div class="card kpi">
        <h3>Annual Leave</h3>
        <p id="annualDays">12 days</p>
      </div>
      <div class="card kpi">
        <h3>Sick Leave</h3>
        <p id="sickDays">5 days</p>
      </div>
      <div class="card kpi">
        <h3>Casual Leave</h3>
        <p id="casualDays">3 days</p>
      </div>
    </section>

    <section style="margin-top:40px;">
      <div class="card">
        <h3 style="margin-bottom:20px;">Leave Requests</h3>
        <table>
          <thead>
            <tr>
              <th>Employee</th>
              <th>Type</th>
              <th>From</th>
              <th>To</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="leaveTable"></tbody>
        </table>
      </div>
    </section>

    <section style="margin-top:30px;text-align:right;">
      <button class="btn" id="requestLeaveBtn">Request Leave</button>
    </section>

  </main>
</div>

<div id="leaveModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:1000;">
  <div class="card" style="width:420px;max-width:90%;">
    <h3>Request Leave</h3>
    <div style="margin-top:10px;">
      <input id="leaveName" placeholder="Employee Name" style="width:100%;padding:12px;margin-bottom:10px;border-radius:10px;border:1px solid var(--border);" />
      <select id="leaveType" style="width:100%;padding:12px;margin-bottom:10px;border-radius:10px;border:1px solid var(--border);">
        <option>Annual</option>
        <option>Sick</option>
        <option>Casual</option>
      </select>
      <input id="leaveFrom" type="date" style="width:100%;padding:12px;margin-bottom:10px;border-radius:10px;border:1px solid var(--border);" />
      <input id="leaveTo" type="date" style="width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);" />
      <button class="btn" style="margin-top:16px;width:100%;" onclick="submitLeave()">Submit</button>
    </div>
  </div>
</div>

<script src="js/auth.js"></script>
<script>
  const allowedRoles = ['Admin','HR Manager','Employee']
  const user = checkAccess(allowedRoles)
  if(user) setupSidebar(user)
  if(user) setupLogout('logoutBtn')
</script>

<script src="js/ui.js"></script>

<script>
  let leaves = [
    { name:'Mary Okafor', type:'Annual', from:'2026-02-01', to:'2026-02-05', status:'Pending' },
    { name:'Samuel Ade', type:'Sick', from:'2026-01-22', to:'2026-01-24', status:'Approved' },
    { name:'Grace Bello', type:'Casual', from:'2026-01-25', to:'2026-01-26', status:'Rejected' }
  ]

  const table = document.getElementById('leaveTable')
  const modal = document.getElementById('leaveModal')

  function renderLeaves() {
    table.innerHTML = ''
    leaves.forEach((l, i) => {
      const tr = document.createElement('tr')
      tr.innerHTML = `
        <td>${l.name}</td>
        <td>${l.type}</td>
        <td>${l.from}</td>
        <td>${l.to}</td>
        <td><span class="badge ${l.status === 'Approved' ? 'success' : l.status === 'Rejected' ? 'danger' : 'warning'}">${l.status}</span></td>
        <td>
          ${l.status === 'Pending' ? `
            <button class="btn" onclick="approveLeave(${i})">Approve</button>
            <button class="btn" onclick="rejectLeave(${i})">Reject</button>
          ` : '—'}
        </td>
      `
      table.appendChild(tr)
    })
  }

  function approveLeave(i) {
    leaves[i].status = 'Approved'
    renderLeaves()
  }

  function rejectLeave(i) {
    leaves[i].status = 'Rejected'
    renderLeaves()
  }

  document.getElementById('requestLeaveBtn').addEventListener('click', () => {
    modal.style.display = 'flex'
  })

  function submitLeave() {
    const leave = {
      name: leaveName.value.trim(),
      type: leaveType.value,
      from: leaveFrom.value,
      to: leaveTo.value,
      status: 'Pending'
    }
    if(leave.name && leave.from && leave.to) {
      leaves.push(leave)
      modal.style.display = 'none'
      renderLeaves()
    }
  }

  modal.addEventListener('click', e => {
    if(e.target === modal) modal.style.display = 'none'
  })

  renderLeaves()
</script>

</body>
</html>
